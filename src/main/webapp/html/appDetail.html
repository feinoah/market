<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
	<title>中通福瑞——应用市场</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<script type="text/javascript" src="../resources/public/scripts/SlideTrans.js" ></script>
	<link href="../resources/public/styles/default.css" rel="stylesheet" type="text/css" />
	<link rel="shortcut icon" href="../resources/favicon.ico" type="image/x-icon"/>
	<link href="../resources/public/styles/XYTipsWindow.css" rel="stylesheet" type="text/css" />
	<link rel="icon" href="../resources/favicon.ico" type="image/x-icon"/>
	<link href="../resources/public/styles/common.css?v=1.5" rel="stylesheet" type="text/css" />
	<link href="../resources/public/styles/app_detail.css" rel="stylesheet" type="text/css" />
	<script type="text/javascript" src="../resources/jquery-easyui-1.2.6/jquery-1.7.2.min.js"></script>
	<script type="text/javascript" src="../resources/jquery-easyui-1.2.6/plugins/jquery.form.js"></script>
	<script type="text/javascript" src="../resources/public/scripts/highcharts.js"></script>
	<script type="text/javascript" src="../resources/public/scripts/utils.js?v=1.5"></script>
	<script type="text/javascript">
	function onPicError(){
		$('.app_detail_icon').error(function(){
			this.src = '../resources/public/images/app_default.jpg';
		});
	$('.container2').error(function(){
		this.src = '../resources/public/images/big_image_error.png';
	});
	}

	function onBigPicError(){
		$('.app_big_icon').error(function(){
			this.src='../resources/public/images/app_pic.jpg';
		});
		$('.doc-screenshot-img').error(function(){
			this.src='../resources/public/images/image_error.jpg';
		});
	}
	var rt = request.QueryString("inputStr");
	$(function(){
		Highcharts.setOptions({
			chart: {
				defaultSeriesType: 'spline',
				backgroundColor:'#F7F7F7',
				color:'#fff',
				style:{fontFamily: '宋体'}
			},
			plotOptions: {//绘图线条控制
				spline:{
					marker:{
						radius:2
					},
					lineWidth:1//线条粗细
				},
				bar: {
					dataLabels: {
						enabled: false
					}
				}
			},
			credits:{//右下角的文本
				enabled: false
			},
			legend:{
				enabled: false
			}
		});	
		$('.Menubox ul li').each(function(i){
			$(this).click(function(){
				$('.Menubox ul li').removeClass('hover').eq(i).addClass('hover');
				$('div[id^=con_two_]').hide().eq(i).show();
			});
		});
	 	$('.star span').each(function(i){
			$(this).click(function(){
				if(i%2==0){
					$('#star_sp'+i).removeClass('starBright_left').addClass('starDark_left');
				}else{
					$('#star_sp'+i).removeClass('starBright_right').addClass('starDark_right');
				}
				$('.star span').each(function(k){
					if(k<=i){//3
						if(k%2==0){
							$('#star_sp'+ k).removeClass('starDark_left').addClass('starBright_left');
							}
						else{
							$('#star_sp'+ k).removeClass('starDark_right').addClass('starBright_right');
						}
						
					}
				});
				$('#grade').val((i+1));
			});
		});
	 	$('#submitBtn').click(function(){
	 		$('#commentForm').form({
	 			dataType : 'text',  
				onSubmit:function(){
					if(rt==''){
						return false;
					}
					$('#appId').val(rt);
					return true;
			    }, 
		    	success:function(data){
					if(data){
						var map=$.parseJSON(data);
						if(map){
							if(map.answerCode==-2){
								tips('submitBtn','请先下载使用再评论','bottom');
							}
							if(map.answerCode==-1){
								tips('submitBtn','请填内容或评分','bottom');
							}
							if(map.answerCode==0){
								tips('submitBtn','没有登录','bottom');
							}
							if(map.answerCode==1){
								location.reload();
							}
						}else{
							tips('submitBtn','后台系统异常','bottom');
						}
					}else{
						tips('submitBtn','后台系统异常','bottom');
					}
			    }
			}).submit();
		});
	 	$.getJSON('../portal/app/'+rt+'?local=cn', function(data) {
			if(data){
				$('#label_appname').empty().html(data.appName);
				$('#label_author').empty().html(data.developer);
				$('#img_icon').empty().attr("src",arrayStar[data.appLevel]);
				$('#comment_star1').attr("src",arrayStar[data.appLevel]);
				$('#comment_star2').attr("src",arrayStar[data.appLevel]);
				$('#comment_star3').attr("src",arrayStar[data.appLevel]);
				$('#img_big_icon').attr("src","../"+data.bigIcon);
				$.each(data.imageList,function(i,item){
					
						$('#idContainer').attr("src","../"+item);
					
					if(i<2){
						$('#app_image'+(i+1)).attr("src","../"+item);
					
					} else {
						return false;
					}
				});
				//TODO:
				$('#label_count').empty().html(data.downCount);
				$('#about_count').empty().html(data.downCount);
				$('#about_date').empty().html(data.updateTime);
				$('#about_version').empty().html(data.version);
				$('#app_version').empty().html(data.version);
				$('#about_android_version').empty().html(data.platform);
				$('#about_Category').empty().html(data.catalogName);
				$('#about_size').empty().html(data.size);
				$('#app_size').empty().html(data.size);
				$('#about_price').empty().html(data.price);
				$('#about_level').empty().html(data.appLevel);
				$('#app_description').empty().html(data.description);
				$('#app_features').empty().html(data.features);
				$('#app_permission').empty().html(data.permissionDesc);
				$('#av_grade1').empty().html(data.appLevel);
				$('#av_grade2').empty().html(data.appLevel);
				$('#app_downcount1').empty().html(data.downCount);
				$('#app_downcount2').empty().html(data.downCount);
				
			}
			onBigPicError();
		});
			
		$.getJSON('../portal/app/hot/free/new/4?local=', function(data) {
			if(data){
				$('#author_more').empty();
				$('#author_more').append('<h3 class="detail_label_left1_top">该开发人员的更多内容:</h3><hr class="detail_hr"/>');		
				$.each(data,function(i,o){
					$('#author_more').append('<div class="detail_left_div"><div class="detail_left1_div"><a href="../html/appDetail.html?inputStr='
							+o.id+'"><img class="app_detail_icon" src="../'
							+o.icon+'"/></a></div><div class="detail_right_div""><a href="../html/appDetail.html?inputStr='+o.id+'"><b>'
					+o.appName+'</b></a><label class="detail_right_label1">'
					+o.developer+'</label><img src="'
					+arrayStar[o.appLevel]+'"/><div style="display:inline-block;width:30px;height:20px;vertical-align:top">('
							+o.downCount+')</div><label style="display: block;">￥'+o.price+'</label></div></div><hr class="detail_hr"/>');
				})
				onPicError();
			}
		});
		
		$.getJSON('../portal/app/down/ref/'+rt+'?rows=6', function(data) {
			if(data){
				$('#view_more').empty();
				$('#view_more').append('<h3 class="detaiil_label_left1_top">安装此应用的用户还安装了:</h3><hr class="detail_hr"/>');		
				$.each(data.rows,function(i,o){
					$('#view_more').append('<div class="detail_left_div"><div class="detail_left1_div"><a href="../html/appDetail.html?inputStr='
							+o.id+'"><img class="app_detail_icon" src="../'
					+o.icon+'"/></a></div><div class="detail_right_div"><a href="../html/appDetail.html?inputStr='+o.id+'"><b>'
					+o.appName+'</b></a><label class="detail_right_label1">'+o.developer+'</label><img src="'
					+arrayStar[o.appLevel]+'"/><div style="display:inline-block;width:30px;height:20px;vertical-align:top">('+o.downCount+')</div><label style="display: block;">￥'
					+o.price+'</label></div></div><hr class="detail_hr"/>');
				})
				onPicError();
			}
		});
		$('#download_btn').click(function(){
			if($('#lolginAfter').is(":visible")){
				open('../portal/app/down/'+rt);
			}else{
				loginWin();
			}
		});
		doPage(1);
		var _data=[0,0,0,0,0]
		$.getJSON('../portal/app/comment/grade/group/'+rt, function(json){
			$.each(json,function(i,o){
				if(o.grade%2!=0){
					o.grade++;
				}
				_data[o.grade/2]+=o.total;
			});
			new Highcharts.Chart({
				chart: {
					renderTo: 'bar_0',
					type: 'bar'
				},
				xAxis: {
					categories: ['★', '★★', '★★★', '★★★★', '★★★★★'],
					title: {
						enabled: false
					}
				},
				yAxis: {
					title: {
						text: '评论人数（人）',
						align: 'high'
					}
				},
				tooltip: {
					formatter: function() {
						return this.y +' 人';
					}
				},
				
				series: [{
					data: _data
				}
				]
			});
			new Highcharts.Chart({
				chart: {
					renderTo: 'bar_1',
					type: 'bar'
				},
				xAxis: {
					categories: ['★', '★★', '★★★', '★★★★', '★★★★★'],
					title: {
						text: null
					}
				},
				yAxis: {
					title: {
						text: '评论人数（人）',
						align: 'high'
					}
				},
				tooltip: {
					formatter: function() {
						return this.y +' 人';
					}
				},
				
				series: [{
					data: _data
				}
				]
			});
		});
		$.getJSON('../portal/app/month/down/trend/'+rt, function(json){
			if(json){
				new Highcharts.Chart({
					chart: {
						renderTo: 'downTrend'
					},
					xAxis: {
						type: 'datetime',
						categories: json.categories,
						title: {
							text:null
						},
						labels:{step:15}
					},
					yAxis: {
						min: 0,
						title: {
							text:null
						},
					},
					tooltip: {
						formatter: function() {
							return this.x+' '+ this.y +' 人';
						}
					},
					series: [{
						data: json.data
					}]
				});
			}
		});
	});
	function doPage(page){
		$.getJSON('../portal/app/comments/'+rt+'?local=cn&page='+page+'&rows=10', function(data) {
			if(data){
				pagination(page, data.totalPage);
				if(page==1){
				$('#appCommentSimple').empty();
				}
				$('#appComment').empty();
				$.each(data.rows,function(i,o){
					if(page==1&&i<3){
						$('#appCommentSimple').append('<div class="doc-review"><span class="doc-review-author"><strong>'+o.nickName+'</strong></span><span class="doc-review-date">评论日期：'
						+o.updateTime+'"</span><div class="doc-review-ratings-line"><img src="'+arrayStar[o.grade]+'" alt="" /></div><p class="review-text">'
						+o.comment+'</p></div><hr class="detail_comment_hr">');
					}
					$('#appComment').append('<div class="doc-review"><span class="doc-review-author"><strong>'+o.nickName+'</strong></span><span class="doc-review-date">评论日期：'
					+o.updateTime+'</span><img style="display:block" src="'+arrayStar[o.grade]+'" alt="" /><p class="review-text">'
					+o.comment+'</p><hr class="detail_comment_hr"></div>');
				});
			}
		});
		
	}
	</script>	
		
	</head>
	<body> 
		<div id="header">
			<div id="nav">
				<div id="loginBefor">
					<button class="login_bn" id="login">登陆</button>
					<button id="reg" class="login_bn">注册</button>
				</div>
				<div id="lolginAfter">
					<span id="welcome"></span>
					<button id="logout" class="login_bn">退出</button>
				</div>
			</div>
			<ul>
				<li><a href="../"><img src="../resources/public/images/carit_logo1.png"/></a></li>
				<li><input class="index_input" id="search_input" type="text" name="txtNo"/></li>
				<li><input type="button" class="search_bn" id="search"></input></li>
			</ul>
		</div>

		<div id="wrapper">
			<div>
				<div class="doc-banner-container-header">
					<div class="page-banner-heading"></div>
					<div>
						<label id="label_appname" style="width:100%;display: block;font-size: 25px;color: white;margin-left: 15px;margin-top: 15px">Recipe Search</label>
						<label id="label_author" style="display: block;color: white;font-size: 12px;margin-left: 15px">ALLTHECOOKS.COM</label>
					</div>
					<div style="float:left">
					    <img id="img_big_icon" class="app_big_icon"/>
					</div>
				    <div style="width: 140px;float:right;">
				     <span style="color:white;font-size:16px;font-weight: bold;margin-top: 50px;display:block">版本:<label id="app_version" >4.0.4</label></span>
				     <span style="color:white;font-size:16px;font-weight: bold;">  大小:<label id="app_size" >6.25MB</label></span>
				     <img id="img_icon" style="display: inline-block;height: 17px;"/>
				    <div class="detail_downcount">(<label id="label_count" style="display: inline-block;font-size: 15px;height: 17px;">10,898</label>)</div>
				     <input type="button" class="download_bn" id="download_btn" value="下载"/>
				   </div>
				</div>
				 
				<img class="container2" id="idContainer" style="float:right;width:686px;"></img>
					<!-- <ul id="idSlider" > 
						<li><a href=""><img src="../resources/public/images/carit_logo2.jpg"/></a></li>
						<li><a href=""><img src="../resources/public/images/carit_logo3.jpg"/></a></li>
						<li><a href=""><img src="../resources/public/images/carit_logo4.jpg"/></a></li>
					    <li><a href=""><img src="../resources/public/images/carit_logo5.jpg"/></a></li>
					</ul>
					<ul class="num" id="idNum"></ul> -->
				
			</div>
  
			<!-- left top -->

			<div id="left" style="float:left;width:29%;margin-top:12px">
				<div id="author_more" style="float:left;width:328px;height:500px;background-color: white;">
				</div>
				<!-- left bottom -->
				<div id="view_more" style="float:left;width:328px;height:620px;margin-top:13px;background-color: white">
				   <h3>安装此应用的用户还安装了：</h3>
			    </div>
		    </div>	
			<!-- left bottom -->
    
<div id="Tab2" style="float:right;width:67%;margin-top:12px;background-color: white">
<div class="Menubox">
   <ul>
       <li class="hover">概览</li>
       <li>用户评论</li>
       <li>新功能</li>
       <li>权限</li>
    </ul>
      </div>
<div class="Contentbox2">  
   <div id="con_two_0" >
   <div style="float:left;margin-left: 15px;width:518px">
  <div style="float:left;width:518px;background-color: #FCFCFC">
  <h2>说明</h2>
  <div id="doc-description-container" class="doc-description-collapsed">
  <div class="doc-description toggle-overflow-contents" style="font-size: 12px">
  <div id="doc-original-text"><label id="app_description">Fantasy Tower Defense from the creators of Toy Soldiers &amp; Dark Alliance 
  "It's an addictive, creative game with some lovely aesthetics and challenging levels. If you're anything like me, it'll probably steal your soul." - KOTAKU</label>
  </div>
  </div><div class="doc-description-overflow"></div></div>
  
  </div>
  
  
  
   <div style="float:left;width:518px;height:302px;border-style:solid;border-width:1pt; border-color:#D7D7D7;border-left: 0px;border-right: 0px;border-bottom: 0px;margin-top:20px">
   <div style="margin-top: 20px">
   <a href="" target="_blank" rel="nofollow">访问开发人员网站</a>
   <a href="" target="_blank" rel="nofollow" class="more-arrow-link"><span class="more-arrow">›</span></a>
   <span class="contact-developer-spacer"></span>
   <a href="" rel="nofollow">向开发人员发送电子邮件</a>
   <a href="" rel="nofollow" class="more-arrow-link"><span class="more-arrow">›</span></a>
   </div>
   <div class="doc-overview-screenshots"><h2>应用屏幕截图</h2>
  
   <table>
   <tr>
   <td><img id="app_image1" class="doc-screenshot-img" title=""/></td>
   <td><img id="app_image2" class="doc-screenshot-img" title=""/></td>
   </tr>
 </table>
  
   </div></div>
   </div>
<div  style="float:right;width:120px;height:531px;border-style:solid;border-width:1pt; border-color:#D7D7D7;border-bottom: 0px;border-right: 0px;border-top: 0px">
<h4>关于此应用</h4>
<dt style="">评分：</dt>

<img id="comment_star1" src="" alt="" style="margin-left: 10px;font-size: 12px"/>
<dd style="">(<span id="about_count" itemprop="ratingCount" content="15333" >15,333</span>)</dd>

<dt style="margin-top: 8px">更新日期：</dt>
<dd><time id="about_date" itemprop="datePublished">2012年5月23日</time></dd>
<dt style="margin-top: 8px">当前版本：</dt>
<dd id="about_version" itemprop="softwareVersion">1.5.4</dd>
<dt itemprop="operatingSystems" content="Android" style="margin-top: 8px">所需的 Android 版本：</dt>
<dd><label id="about_android_version">2.3</label>及更高版本</dd>
<dt style="margin-top: 8px">类别：</dt>
<dd id="about_Category">游戏</dd>
<dt style="margin-top: 8px">已安装次数：</dt>
<dd itemprop="numDownloads">
	<div class="normalized-daily-installs-chart"
		style="width: 105px;height: 105px;" id="downTrend">
	</div>
</dd>
<dt style="margin-top: 8px">大小：</dt>
   <dd id="about_size" itemprop="fileSize" style="display: inline-block;">49</dd><label style="display: inline-block;">M</label>
   <dt style="margin-top: 8px">价格：</dt>
   <dd itemprop="offers" itemscope="" itemtype="http://schema.org/Offer">
  <label style="display: inline-block;">￥</label> <label id="about_price" style="display: inline-block;"></label>
   <dt style="margin-top: 8px">内容分级：</dt>
   <label style="margin-left: 10px">心智成熟度-</label >  <label id="about_level"></label >
   
   </div>
   
   <div  style="float: left;margin-left: 15px;"><h2>用户评论</h2>  
   <div class="histogram-table goog-inline-block" id="bar_0" style="width: 320px;height: 115px;">
   </div>
   
   <div class="average-rating average-rating-panel goog-inline-block">
   <div class="average-rating-title">平均评分：</div>
   <div id="av_grade1" class="average-rating-value">4.8</div>
   <div class="average-rating-stars">
  <img id="comment_star2" src="" alt="" />
   </div>
   <div id="app_downcount1" class="votes">18,191</div></div>
   
   
   
   <div id="appCommentSimple" class="doc-review-summary_simple">
  
   </div>
   
   <a class="tabBarLink" data-tabbarid="details" data-tabbarindex="1">阅读所有用户评论</a>
   <a class="more-arrow-link" data-tabbarid="details" data-tabbarindex="1"><span class="more-arrow">›</span></a></div>
   
   </div>
   
   <div id="con_two_1" style="display: none;">
   
   <div  style="float: left;margin-left: 15px;"><h2>用户评分</h2>  
   <div class="histogram-table goog-inline-block" id="bar_1" style="width: 320px;height: 115px;">
   </div>
   
   <div class="average-rating average-rating-panel goog-inline-block">
   <div class="average-rating-title">平均评分：</div>
   <div id="av_grade2" class="average-rating-value">4.8</div>
   <div class="average-rating-stars">
  <img id="comment_star3" src="" alt="" />
   </div>
   <div id="app_downcount2" class="votes">18,191</div></div>
   <div>
   <h2 class="goog-inline-block middle-vertical-align">用户评论</h2>
   <div id="write-review-toggle" class="goog-inline-block toggle-button" data-toggletarget="my-review-panel-id write-review-container" tabindex="0">我要评论 &gt;</div>
   </div>
   
   <form action="../portal/app/comment/add" method="post" id="commentForm" >
   <div id="commentInput">
       内容：<input id="comment" name="comment" type="text" style="width: 600px;height: 150px;display: block"/><div class="star">评分：<span id="star_sp0" class="starDark_left"></span><span id="star_sp1" class="starDark_right"></span><span id="star_sp2" class="starDark_left"></span><span id="star_sp3" class="starDark_right"></span><span id="star_sp4" class="starDark_left"></span><span id="star_sp5" class="starDark_right"></span><span id="star_sp6" class="starDark_left"></span><span id="star_sp7" class="starDark_right"></span><span id="star_sp8" class="starDark_left"></span><span id="star_sp9" class="starDark_right"></span>
   <button class="comment_submit" id="submitBtn">提交</button></div>
   <input type="hidden" name="grade" id="grade"/>
   <input type="hidden" name="appId" id="appId"/>
   </div>
   </form>
   
   <div id="appComment" class="doc-review-summary">  
   
   </div>
   
   <div id="pageDiv">    
    </div>
 </div>
 
 </div>
  <div id="con_two_2" style="display: none;">
  	<div id="app_features" style="float:left;margin-left: 15px;width:518px">
  	</div>
  </div>
  <div id="con_two_3" style="display: none;">
  	<div id="app_permission" style="float:left;margin-left: 15px;width:518px">
  	</div>
  </div>
</div>
</div>
</div>
<script>
/*var nums = [], timer, n = $$("idSlider").getElementsByTagName("li").length,
st = new SlideTrans("idContainer", "idSlider", 4, { onStart: function(){//设置按钮样式
	forEach(nums, function(o, i){ o.className = st.Index == i ? "on" : ""; })
}});

for(var i = 1; i <= n; AddNum(i++)){};
function AddNum(i){
	var num = $$("idNum").appendChild(document.createElement("li"));
	num.innerHTML = i--;
	num.onmouseover = function(){
		timer = setTimeout(function(){ num.className = "on"; st.Auto = false; st.Run(i); }, 200);
	}
	num.onmouseout = function(){ clearTimeout(timer); num.className = ""; st.Auto = true; st.Run(); 
	}
	nums[i] = num;
}
st.Run();*/

</script>	
		
	</body>
</html>